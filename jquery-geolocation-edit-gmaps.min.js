// jQuery geolocation-edit-gmaps plugin v0.0.2 (2011-12-21)
// Copyright (c) 2011 Milos Popovic <the.elephant@gmail.com>
// see: http://github.com/miloss/jquery-geolocation-edit
(function(a){var g,i,j;g=[];i={main:function(){},initMap:function(c){var b=a(this).get(0),e,d=a.data(b,"opts");e=new google.maps.Map(b,a.extend({center:c},d.mapOptions));c=a.extend({map:e,position:c},d.markerOptions);c=new google.maps.Marker(c);a.data(b,"map",e);a.data(b,"marker",c);google.maps.event.addListener(c,"dragend",function(){a(b).geolocate({},"getMarkerLocation")})},callGeocoder:function(){for(var c=a(this).get(0),b="",e=a.data(c,"opts"),d=e.address.length;d--;)b+=a(e.address[d]).val(); (new google.maps.Geocoder).geocode({address:b},function(b){var d,e,g;d=b[0];if("undefined"!==typeof d)e=a.data(c,"map"),g=a.data(c,"marker"),b=d.geometry.location,e.panToBounds(d.geometry.viewport),e.panTo(b),g.setPosition(b),a(c).geolocate({},"getMarkerLocation")})},getMarkerLocation:function(){var c=a(this).get(0),b=a.data(c,"marker"),c=a.data(c,"opts"),b=b.getPosition();a(c.lat).val(b.lat());a(c.lng).val(b.lng())}};jQuery.fn.geolocate=function(c,b){var e=this,d,f,h;if("undefined"===typeof b){if("undefined"=== typeof c.lat||"undefined"===typeof c.lng){a.error("Please provide 'lat' and 'lng' options for jQuery.geolocate");return}if("undefined"===typeof google||"undefined"===typeof google.maps){g.push(function(){a(e).geolocate(c)});j();return}d=a.extend(!0,{address:[],changeOnEdit:!1,mapOptions:{zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},markerOptions:{draggable:!0,animation:google.maps.Animation.DROP}},c);a(this).data("opts",d);f=parseFloat(a(d.lat).val());h= parseFloat(a(d.lng).val());!isNaN(f)&&!isNaN(h)&&(f=new google.maps.LatLng(f,h),a(this).geolocate({},"initMap",f));d.changeOnEdit&&(a(d.lat).change(function(){}),a(d.lng).change(function(){}));h=d.address.length;if(0<h)for(f=0;f<h;f++)a(d.address[f]).change(function(){a(e).geolocate({},"callGeocoder")})}else{if(i[b])return i[b].apply(this,Array.prototype.slice.call(arguments,2));a.error("Method "+b+" does not exist on jQuery.geolocate")}return this};jQuery.fn.geolocateGMapsLoaded=function(){for(;g.length;)g.shift()()}; j=function(){var a=!1;return function(){var b;if(!a)a=!0,b=document.createElement("script"),b.type="text/javascript",b.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=$.fn.geolocateGMapsLoaded",document.body.appendChild(b)}}()})(jQuery);